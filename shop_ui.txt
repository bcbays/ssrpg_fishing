var currencyGlyph = "♠"
var currRodLevel = 0 //FIXME: progress.txt
var scales = 1000000000 // FIXME
var cyanPrice = 100
var yellowPrice = 1000
var greenPrice = 10000
var bluePrice = 100000
var redPrice = 1000000
var rainbowPrice = 10000000

var rodSpriteA = ascii
#
#####,
####/;
###/´
##/!
asciiend

var skeletimmySprite = ascii
##
##
###_{)
##''¯)
####/(
asciiend

var rowStyle = ui.AddStyle("
^├#┤
^│#│
^└─┘")

var topRowInsideBtnStyle = ui.AddStyle("
^┬─┬
^│#│
^┴─┴")

var topRowLastBtnStyle = ui.AddStyle("
^┬─┐
^│#│
^┴─┘")

var shopIsHidden = true
var currPurchaseButton = null
var shopPanelSpeed = 2
var shopPanelOvershoot = true
var purchaseFailed = false
var purchaseFailedTimer = 0
var purchaseFailedLabel = null

var shopPanelRoot = null
var shopRowPanel0 = null
var shopRowPanel1 = null
var shopRowPanel2 = null

var whiteRodRoot = null
var whiteRodLabel = null
var cyanRodCost = "100"
var cyanRodRoot = null
var cyanRodButton = null
var cyanRodLabel = null
var yellowRodCost = "1000"
var yellowRodRoot = null
var yellowRodButton = null
var yellowRodLabel = null
var greenRodCost = "10K"
var greenRodRoot = null
var greenRodButton = null
var greenRodLabel = null
var blueRodCost = "100K"
var blueRodRoot = null
var blueRodButton = null
var blueRodLabel = null
var redRodCost = "1M"
var redRodRoot = null
var redRodButton = null
var redRodLabel = null
var rainbowRodCost = "10M"
var rainbowRodRoot = null
var rainbowRodButton = null
var rainbowRodLabel = null

func Init()
  ?shopPanelRoot = null
    shopPanelRoot = ui.AddPanel()
    shopPanelRoot.visible = true
    shopPanelRoot.x = 0
    shopPanelRoot.y = screen.h
    shopPanelRoot.w = screen.w
    shopPanelRoot.h = screen.h

  ?shopRowPanel0 = null
    shopRowPanel0 = ui.AddPanel()
    shopPanelRoot.Add(shopRowPanel0)
    shopRowPanel0.x = 0
    shopRowPanel0.y = 0
    shopRowPanel0.w = 57
    shopRowPanel0.h = 8
    shopRowPanel0.dock = top_right
    shopRowPanel0.anchor = top_right
    shopRowPanel0.color = #808080

    AddRodItem(white)
    AddRodItem(cyan)
    AddRodItem(yellow)
    AddRodItem(green)
    AddRodItem(blue)
    AddRodItem(red)
    AddRodItem(rainbow)
  
  ?shopRowPanel1 = null
    shopRowPanel1 = ui.AddPanel()
    shopPanelRoot.Add(shopRowPanel1)
    shopRowPanel1.x = 0
    shopRowPanel1.y = 7
    shopRowPanel1.w = 57
    shopRowPanel1.h = 8
    shopRowPanel1.dock = top_right
    shopRowPanel1.anchor = top_right
    shopRowPanel1.style = rowStyle
    shopRowPanel1.color = #808080

  ?shopRowPanel2 = null
    shopRowPanel2 = ui.AddPanel()
    shopPanelRoot.Add(shopRowPanel2)
    shopRowPanel2.x = 0
    shopRowPanel2.y = 14
    shopRowPanel2.w = 57
    shopRowPanel2.h = 8
    shopRowPanel2.dock = top_right
    shopRowPanel2.anchor = top_right
    shopRowPanel2.style = rowStyle
    shopRowPanel2.color = #808080

//TESTING
Init()
Update()
Show()
//Hide()
//scales = 500

func Show()
  shopIsHidden = false

func Hide()
  shopIsHidden = true
  shopPanelOvershoot = true

func Update()
  >@currencyGlyph+scales@ 
  ?shopIsHidden
    ?shopPanelRoot.y < screen.h
      shopPanelRoot.y = shopPanelRoot.y + shopPanelSpeed
    :
      shopPanelRoot.y = screen.h
      shopPanelRoot.visible = false
      ?currPurchaseButton ! null
        currPurchaseButton.visible = false
  :
    ?shopPanelRoot.y > -3 & shopPanelOvershoot
      shopPanelRoot.y = shopPanelRoot.y - shopPanelSpeed
      shopPanelRoot.visible = true
      ?currPurchaseButton ! null
        currPurchaseButton.visible = true
    :?shopPanelRoot.y <= -3 & shopPanelOvershoot
      shopPanelOvershoot = false
    :?shopPanelRoot.y < 0
      shopPanelRoot.y = shopPanelRoot.y + 1
    :
      shopPanelRoot.y = 0

  ?purchaseFailed
    ?time >= purchaseFailedTimer
      purchaseFailedLabel.color = #white
      purchaseFailed = false

func purchaseRod()
  ?currRodLevel = 0
    ?scales >= cyanPrice
      play buy
      scales = scales - cyanPrice
      currRodLevel++
      currPurchaseButton = yellowRodButton
      cyanRodButton.visible = false
      cyanRodLabel.text = "owned"
      cyanRodLabel.color = #808080
      yellowRodButton.visible = true
      yellowRodLabel.text = currencyGlyph+yellowRodCost
      yellowRodLabel.color = #white
    :
      play error
      cyanRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = cyanRodLabel
  :?currRodLevel = 1
    ?scales >= yellowPrice
      play buy
      scales = scales - yellowPrice
      currRodLevel++
      currPurchaseButton = greenRodButton
      yellowRodButton.visible = false
      yellowRodLabel.text = "owned"
      yellowRodLabel.color = #808080
      greenRodButton.visible = true
      greenRodLabel.text = currencyGlyph+greenRodCost
      greenRodLabel.color = #white
    :
      play error
      yellowRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = yellowRodLabel
  :?currRodLevel = 2
    ?scales >= greenPrice
      play buy
      scales = scales - greenPrice
      currRodLevel++
      currPurchaseButton = blueRodButton
      greenRodButton.visible = false
      greenRodLabel.text = "owned"
      greenRodLabel.color = #808080
      blueRodButton.visible = true
      blueRodLabel.text = currencyGlyph+blueRodCost
      blueRodLabel.color = #white
    :
      play error
      greenRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = greenRodLabel
  :?currRodLevel = 3
    ?scales >= bluePrice
      play buy
      scales = scales - bluePrice
      currRodLevel++
      currPurchaseButton = redRodButton
      blueRodButton.visible = false
      blueRodLabel.text = "owned"
      blueRodLabel.color = #808080
      redRodButton.visible = true
      redRodLabel.text = currencyGlyph+redRodCost
      redRodLabel.color = #white
    :
      play error
      blueRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = blueRodLabel
  :?currRodLevel = 4
    ?scales >= redPrice
      play buy
      scales = scales - redPrice
      currRodLevel++
      currPurchaseButton = rainbowRodButton
      redRodButton.visible = false
      redRodLabel.text = "owned"
      redRodLabel.color = #808080
      rainbowRodButton.visible = true
      rainbowRodLabel.text = currencyGlyph+rainbowRodCost
      rainbowRodLabel.color = #white
    :
      play error
      redRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = redRodLabel
  :?currRodLevel = 5
    ?scales >= rainbowPrice
      play buy
      scales = scales - rainbowPrice
      currRodLevel++
      currPurchaseButton = null
      rainbowRodButton.visible = false
      rainbowRodLabel.text = "owned"
      rainbowRodLabel.color = #808080
    :
      play error
      rainbowRodLabel.color = #red
      purchaseFailed = true
      purchaseFailedTimer = time+30
      purchaseFailedLabel = rainbowRodLabel

func AddRodItem(rodColor)
  ?rodColor = white
    ?whiteRodRoot = null
      whiteRodRoot = ui.AddPanel()
      shopRowPanel0.Add(whiteRodRoot)
      whiteRodRoot.ax = left
      whiteRodRoot.dx = left
      whiteRodRoot.x = 0
      whiteRodRoot.y = 0
      whiteRodRoot.w = 9
      whiteRodRoot.h = 8
      whiteRodRoot.color = #808080

      var whiteRodIcon = ui.AddAnim(rodSpriteA)
      whiteRodRoot.Add(whiteRodIcon)
      whiteRodIcon.color = #white
      whiteRodIcon.w = 7
      whiteRodIcon.h = 8

      whiteRodLabel = ui.AddText("owned")
      whiteRodRoot.Add(whiteRodLabel)
      whiteRodLabel.dock = bottom_center
      whiteRodLabel.anchor = bottom_center
      whiteRodLabel.align = center
      whiteRodLabel.color = #808080
      whiteRodLabel.w = 7
      whiteRodLabel.h = 1
      whiteRodLabel.x = 0
      whiteRodLabel.y = -1
  :?rodColor = cyan
    ?cyanRodRoot = null
      cyanRodRoot = ui.AddPanel()
      shopRowPanel0.Add(cyanRodRoot)
      cyanRodRoot.ax = left
      cyanRodRoot.dx = left
      cyanRodRoot.x = 8
      cyanRodRoot.y = 0
      cyanRodRoot.w = 9
      cyanRodRoot.h = 8
      cyanRodRoot.style = topRowInsideBtnStyle
      cyanRodRoot.color = #808080

      cyanRodButton = ui.AddButton()
      cyanRodRoot.Add(cyanRodButton)
      cyanRodButton.w = 9
      cyanRodButton.h = 8
      cyanRodButton.text = ""
      cyanRodButton.style = topRowInsideBtnStyle
      cyanRodButton.SetPressed(purchaseRod)
      cyanRodButton.visible = false

      var cyanRodIcon = ui.AddAnim(rodSpriteA)
      cyanRodRoot.Add(cyanRodIcon)
      cyanRodIcon.color = #cyan
      cyanRodIcon.w = 7
      cyanRodIcon.h = 8

      cyanRodLabel = ui.AddText("?")
      cyanRodRoot.Add(cyanRodLabel)
      cyanRodLabel.dock = bottom_center
      cyanRodLabel.anchor = bottom_center
      cyanRodLabel.align = center
      cyanRodLabel.color = #808080
      cyanRodLabel.w = 7
      cyanRodLabel.h = 1
      cyanRodLabel.x = 0
      cyanRodLabel.y = -1
      ?currRodLevel = 0
        cyanRodLabel.color = #white
        cyanRodLabel.text = currencyGlyph+cyanRodCost
        cyanRodButton.visible = true
        currPurchaseButton = cyanRodButton
      :?currRodLevel >= 1
        cyanRodLabel.text = "owned"
  :?rodColor = yellow
    ?yellowRodRoot = null
      yellowRodRoot = ui.AddPanel()
      shopRowPanel0.Add(yellowRodRoot)
      yellowRodRoot.ax = left
      yellowRodRoot.dx = left
      yellowRodRoot.x = 16
      yellowRodRoot.y = 0
      yellowRodRoot.w = 9
      yellowRodRoot.h = 8
      yellowRodRoot.style = topRowInsideBtnStyle
      yellowRodRoot.color = #808080

      yellowRodButton = ui.AddButton()
      yellowRodRoot.Add(yellowRodButton)
      yellowRodButton.w = 9
      yellowRodButton.h = 8
      yellowRodButton.text = ""
      yellowRodButton.style = topRowInsideBtnStyle
      yellowRodButton.SetPressed(purchaseRod)
      yellowRodButton.visible = false

      var yellowRodIcon = ui.AddAnim(rodSpriteA)
      yellowRodRoot.Add(yellowRodIcon)
      yellowRodIcon.color = #yellow
      yellowRodIcon.w = 7
      yellowRodIcon.h = 8

      yellowRodLabel = ui.AddText("?")
      yellowRodRoot.Add(yellowRodLabel)
      yellowRodLabel.dock = bottom_center
      yellowRodLabel.anchor = bottom_center
      yellowRodLabel.align = center
      yellowRodLabel.color = #808080
      yellowRodLabel.w = 7
      yellowRodLabel.h = 1
      yellowRodLabel.x = 0
      yellowRodLabel.y = -1
      ?currRodLevel = 1
        yellowRodLabel.color = #white
        yellowRodLabel.text = currencyGlyph+yellowRodCost
        yellowRodButton.visible = true
        currPurchaseButton = yellowRodButton
      :?currRodLevel >= 2
        yellowRodLabel.text = "owned"
  :?rodColor = green
    ?greenRodRoot = null
      greenRodRoot = ui.AddPanel()
      shopRowPanel0.Add(greenRodRoot)
      greenRodRoot.ax = left
      greenRodRoot.dx = left
      greenRodRoot.x = 24
      greenRodRoot.y = 0
      greenRodRoot.w = 9
      greenRodRoot.h = 8
      greenRodRoot.style = topRowInsideBtnStyle
      greenRodRoot.color = #808080

      greenRodButton = ui.AddButton()
      greenRodRoot.Add(greenRodButton)
      greenRodButton.w = 9
      greenRodButton.h = 8
      greenRodButton.text = ""
      greenRodButton.style = topRowInsideBtnStyle
      greenRodButton.SetPressed(purchaseRod)
      greenRodButton.visible = false

      var greenRodIcon = ui.AddAnim(rodSpriteA)
      greenRodRoot.Add(greenRodIcon)
      greenRodIcon.color = #green
      greenRodIcon.w = 7
      greenRodIcon.h = 8

      greenRodLabel = ui.AddText("?")
      greenRodRoot.Add(greenRodLabel)
      greenRodLabel.dock = bottom_center
      greenRodLabel.anchor = bottom_center
      greenRodLabel.align = center
      greenRodLabel.color = #808080
      greenRodLabel.w = 7
      greenRodLabel.h = 1
      greenRodLabel.x = 0
      greenRodLabel.y = -1
      ?currRodLevel = 2
        greenRodLabel.color = #white
        greenRodLabel.text = currencyGlyph+greenRodCost
        greenRodButton.visible = true
        currPurchaseButton = greenRodButton
      :?currRodLevel >= 3
        greenRodLabel.text = "owned"
  :?rodColor = blue
    ?blueRodRoot = null
      blueRodRoot = ui.AddPanel()
      shopRowPanel0.Add(blueRodRoot)
      blueRodRoot.ax = left
      blueRodRoot.dx = left
      blueRodRoot.x = 32
      blueRodRoot.y = 0
      blueRodRoot.w = 9
      blueRodRoot.h = 8
      blueRodRoot.style = topRowInsideBtnStyle
      blueRodRoot.color = #808080

      blueRodButton = ui.AddButton()
      blueRodRoot.Add(blueRodButton)
      blueRodButton.w = 9
      blueRodButton.h = 8
      blueRodButton.text = ""
      blueRodButton.style = topRowInsideBtnStyle
      blueRodButton.SetPressed(purchaseRod)
      blueRodButton.visible = false

      var blueRodIcon = ui.AddAnim(rodSpriteA)
      blueRodRoot.Add(blueRodIcon)
      blueRodIcon.color = #blue
      blueRodIcon.w = 7
      blueRodIcon.h = 8

      blueRodLabel = ui.AddText("?")
      blueRodRoot.Add(blueRodLabel)
      blueRodLabel.dock = bottom_center
      blueRodLabel.anchor = bottom_center
      blueRodLabel.align = center
      blueRodLabel.color = #808080
      blueRodLabel.w = 7
      blueRodLabel.h = 1
      blueRodLabel.x = 0
      blueRodLabel.y = -1
      ?currRodLevel = 3
        blueRodLabel.color = #white
        blueRodLabel.text = currencyGlyph+blueRodCost
        blueRodButton.visible = true
        currPurchaseButton = blueRodButton
      :?currRodLevel >= 4
        blueRodLabel.text = "owned"
  :?rodColor = red
    ?redRodRoot = null
      redRodRoot = ui.AddPanel()
      shopRowPanel0.Add(redRodRoot)
      redRodRoot.ax = left
      redRodRoot.dx = left
      redRodRoot.x = 40
      redRodRoot.y = 0
      redRodRoot.w = 9
      redRodRoot.h = 8
      redRodRoot.style = topRowInsideBtnStyle
      redRodRoot.color = #808080

      redRodButton = ui.AddButton()
      redRodRoot.Add(redRodButton)
      redRodButton.w = 9
      redRodButton.h = 8
      redRodButton.text = ""
      redRodButton.style = topRowInsideBtnStyle
      redRodButton.SetPressed(purchaseRod)
      redRodButton.visible = false

      var redRodIcon = ui.AddAnim(rodSpriteA)
      redRodRoot.Add(redRodIcon)
      redRodIcon.color = #red
      redRodIcon.w = 7
      redRodIcon.h = 8

      redRodLabel = ui.AddText("?")
      redRodRoot.Add(redRodLabel)
      redRodLabel.dock = bottom_center
      redRodLabel.anchor = bottom_center
      redRodLabel.align = center
      redRodLabel.color = #808080
      redRodLabel.w = 7
      redRodLabel.h = 1
      redRodLabel.x = 0
      redRodLabel.y = -1
      ?currRodLevel = 4
        redRodLabel.color = #white
        redRodLabel.text = currencyGlyph+redRodCost
        redRodButton.visible = true
        currPurchaseButton = redRodButton
      :?currRodLevel >= 5
        redRodLabel.text = "owned"
  :?rodColor = rainbow
    ?rainbowRodRoot = null
      rainbowRodRoot = ui.AddPanel()
      shopRowPanel0.Add(rainbowRodRoot)
      rainbowRodRoot.ax = left
      rainbowRodRoot.dx = left
      rainbowRodRoot.x = 48
      rainbowRodRoot.y = 0
      rainbowRodRoot.w = 9
      rainbowRodRoot.h = 8
      rainbowRodRoot.style = topRowLastBtnStyle
      rainbowRodRoot.color = #808080

      rainbowRodButton = ui.AddButton()
      rainbowRodRoot.Add(rainbowRodButton)
      rainbowRodButton.w = 9
      rainbowRodButton.h = 8
      rainbowRodButton.text = ""
      rainbowRodButton.style = topRowLastBtnStyle
      rainbowRodButton.SetPressed(purchaseRod)
      rainbowRodButton.visible = false

      var rainbowRodIcon = ui.AddAnim(rodSpriteA)
      rainbowRodRoot.Add(rainbowRodIcon)
      rainbowRodIcon.color = #rainbow
      rainbowRodIcon.w = 7
      rainbowRodIcon.h = 8

      rainbowRodLabel = ui.AddText("?")
      rainbowRodRoot.Add(rainbowRodLabel)
      rainbowRodLabel.dock = bottom_center
      rainbowRodLabel.anchor = bottom_center
      rainbowRodLabel.align = center
      rainbowRodLabel.color = #808080
      rainbowRodLabel.w = 7
      rainbowRodLabel.h = 1
      rainbowRodLabel.x = 0
      rainbowRodLabel.y = -1
      ?currRodLevel = 5
        rainbowRodLabel.color = #white
        rainbowRodLabel.text = currencyGlyph+rainbowRodCost
        rainbowRodButton.visible = true
        currPurchaseButton = rainbowRodButton
      :?currRodLevel >= 6
        rainbowRodLabel.text = "owned"